// generated by Diff/AST Java Unparser
package io.shardingjdbc.orchestration.api;
import io.shardingjdbc.core.api.MasterSlaveDataSourceFactory;
import io.shardingjdbc.core.api.config.MasterSlaveRuleConfiguration;
import io.shardingjdbc.core.jdbc.core.datasource.MasterSlaveDataSource;
import io.shardingjdbc.orchestration.api.config.OrchestrationConfiguration;
import io.shardingjdbc.orchestration.internal.OrchestrationFacade;
import io.shardingjdbc.orchestration.yaml.YamlOrchestrationMasterSlaveRuleConfiguration;
import lombok.AccessLevel;
import lombok.NoArgsConstructor;
import org.yaml.snakeyaml.Yaml;
import org.yaml.snakeyaml.constructor.Constructor;
import javax.sql.DataSource;
import java.io.*;
import java.sql.SQLException;
import java.util.Map;
@NoArgsConstructor(access=AccessLevel.PRIVATE)
public
final
class OrchestrationMasterSlaveDataSourceFactory
{
   public
   static
   DataSource createDataSource(final Map<String,DataSource> dataSourceMap, 
                               final MasterSlaveRuleConfiguration masterSlaveRuleConfig,
                               final Map<String,Object> configMap, 
                               final OrchestrationConfiguration orchestrationConfig)
     throws SQLException {
     MasterSlaveDataSource result =
       (MasterSlaveDataSource)MasterSlaveDataSourceFactory.createDataSource(dataSourceMap,
                                masterSlaveRuleConfig, configMap);
     new OrchestrationFacade(orchestrationConfig).initMasterSlaveOrchestration(dataSourceMap,
       masterSlaveRuleConfig, result, configMap);
     return result;
   }
   public
   static
   DataSource createDataSource(final File yamlFile)
     throws SQLException, IOException {
     YamlOrchestrationMasterSlaveRuleConfiguration config =
       unmarshal(yamlFile);
     return createDataSource(config.getDataSources(),
              config.getMasterSlaveRule().getMasterSlaveRuleConfiguration(),
              config.getMasterSlaveRule().getConfigMap(),
              config.getOrchestration().getOrchestrationConfiguration());
   }
   public
   static
   DataSource createDataSource(final Map<String,DataSource> dataSourceMap, 
                               final File yamlFile)
     throws SQLException, IOException {
     YamlOrchestrationMasterSlaveRuleConfiguration config =
       unmarshal(yamlFile);
     return createDataSource(dataSourceMap,
              config.getMasterSlaveRule().getMasterSlaveRuleConfiguration(),
              config.getMasterSlaveRule().getConfigMap(),
              config.getOrchestration().getOrchestrationConfiguration());
   }
   public
   static
   DataSource createDataSource(final byte[] yamlByteArray)
     throws SQLException, IOException {
     YamlOrchestrationMasterSlaveRuleConfiguration config =
       unmarshal(yamlByteArray);
     return createDataSource(config.getDataSources(),
              config.getMasterSlaveRule().getMasterSlaveRuleConfiguration(),
              config.getMasterSlaveRule().getConfigMap(),
              config.getOrchestration().getOrchestrationConfiguration());
   }
   public
   static
   DataSource createDataSource(final Map<String,DataSource> dataSourceMap, 
                               final byte[] yamlByteArray)
     throws SQLException, IOException {
     YamlOrchestrationMasterSlaveRuleConfiguration config =
       unmarshal(yamlByteArray);
     return createDataSource(dataSourceMap,
              config.getMasterSlaveRule().getMasterSlaveRuleConfiguration(),
              config.getMasterSlaveRule().getConfigMap(),
              config.getOrchestration().getOrchestrationConfiguration());
   }
   private
   static
   YamlOrchestrationMasterSlaveRuleConfiguration unmarshal(final File yamlFile)
     throws IOException {
     try (FileInputStream fileInputStream = new FileInputStream(yamlFile);
          InputStreamReader inputStreamReader =
            new InputStreamReader(fileInputStream, "UTF-8")) {
       return new Yaml(new Constructor(YamlOrchestrationMasterSlaveRuleConfiguration.class)).loadAs(inputStreamReader,
                YamlOrchestrationMasterSlaveRuleConfiguration.class);
     } 
   }
   private
   static
   YamlOrchestrationMasterSlaveRuleConfiguration unmarshal(final byte[] yamlByteArray)
     throws IOException {
     return new Yaml(new Constructor(YamlOrchestrationMasterSlaveRuleConfiguration.class)).loadAs(
              new ByteArrayInputStream(yamlByteArray),
              YamlOrchestrationMasterSlaveRuleConfiguration.class);
   }
}