// generated by Diff/AST Java Unparser
package gov.nasa.arc.mct.fastplot.view;
import gov.nasa.arc.mct.fastplot.bridge.LegendEntry;
import gov.nasa.arc.mct.fastplot.bridge.PlotConstants;
import gov.nasa.arc.mct.fastplot.bridge.PlotLineColorPalette;
import java.awt.Color;
import java.awt.Component;
import java.awt.Graphics;
import java.awt.event.ActionEvent;
import java.awt.event.ActionListener;
import java.util.ResourceBundle;
import javax.swing.Icon;
import javax.swing.JMenu;
import javax.swing.JMenuItem;
import javax.swing.JPopupMenu;
import javax.swing.JRadioButtonMenuItem;
public class LegendEntryPopupMenuFactory {
  private static final ResourceBundle BUNDLE = ResourceBundle.getBundle(
      LegendEntryPopupMenuFactory.class.getName().substring(
          0, LegendEntryPopupMenuFactory.class.getName().lastIndexOf(".")) +
      ".Bundle");
  private PlotViewManifestation manifestation;
  public LegendEntryPopupMenuFactory(
      PlotViewManifestation targetPlotManifestation) {
    manifestation = targetPlotManifestation;
  }
  public JPopupMenu getPopup(LegendEntry entry) {
    LegendEntryPopup popup = new LegendEntryPopup(manifestation, entry);
    return popup;
  }
  private class LegendEntryPopup extends JPopupMenu {
    private static final long serialVersionUID = -4846098785335776279L;
    public LegendEntryPopup(final PlotViewManifestation manifestation,
                            final LegendEntry legendEntry) {
      super();
      Color assigned = legendEntry.getForeground();
      String name = legendEntry.getComputedBaseDisplayName();
      if (name.isEmpty())
        name = legendEntry.getFullBaseDisplayName();
      String subMenuText =
          String.format(BUNDLE.getString("SelectColor.label"), name);
      JMenu subMenu = new JMenu(subMenuText);
      if (!manifestation.isLocked()) {
        for (int i = 0; i < PlotConstants.MAX_NUMBER_OF_DATA_ITEMS_ON_A_PLOT;
             i++) {
          JMenuItem item = new JRadioButtonMenuItem(
              "", new SolidColorIcon(PlotLineColorPalette.getColor(i)),
              (assigned == PlotLineColorPalette.getColor(i)));
          final int colorIndex = i;
          item.addActionListener(new ActionListener() {
            @Override
            public void actionPerformed(ActionEvent e) {
              legendEntry.setForeground(
                  PlotLineColorPalette.getColor(colorIndex));
              manifestation.setupPlotLineColors();
            }
          });
          subMenu.add(item);
        }
        add(subMenu);
      }
    }
    private class SolidColorIcon implements Icon {
      private Color iconColor;
      public SolidColorIcon(Color c) { iconColor = c; }
      @Override
      public int getIconHeight() {
        return 12;
      }
      @Override
      public int getIconWidth() {
        return 48;
      }
      @Override
      public void paintIcon(Component arg0, Graphics g, int x, int y) {
        g.setColor(iconColor);
        g.fillRect(x, y, getIconWidth(), getIconHeight() - 1);
        g.setColor(iconColor.darker());
        g.drawRect(x, y, getIconWidth(), getIconHeight() - 1);
      }
    }
  }
}